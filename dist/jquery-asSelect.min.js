/**
* jQuery asSelect v0.2.1
* https://github.com/amazingSurge/jquery-asSelect
*
* Copyright (c) amazingSurge
* Released under the LGPL-3.0 license
*/
!function(t,e){if("function"==typeof define&&define.amd)define(["jquery"],e);else if("undefined"!=typeof exports)e(require("jquery"));else{var s={exports:{}};e(t.jQuery),t.jqueryAsSelectEs=s.exports}}(this,function(t){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=e(t),a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},n=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),o={namespace:"asSelect",skin:null,trigger:"click",offset:[0,0],json:null,preload:!1,load:null,maxHeight:350,select:void 0,render:{label:function(t){return t?t.text:"Choose one"},option:function(t){return t.text},group:function(t){return t.label}},onChange:function(){}},r="asSelect",l=[],u=function(){function t(e){var a=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];s(this,t),this.element=e,this.$select=(0,i.default)(e);var n=[];i.default.each(this.$select.data(),function(t,e){var s=new RegExp("^asSelect","i");s.test(t)&&(n[t.toLowerCase().replace(s,"")]=e)}),this.options=i.default.extend(!0,{},o,a,n),this.namespace=this.options.namespace,this.classes={wrapper:this.namespace+"-wrapper",old:this.namespace+"-old",dropdown:this.namespace+"-dropdown",trigger:this.namespace+"-trigger",label:this.namespace+"-label",handler:this.namespace+"-handler",item:this.namespace+"-item",group:this.namespace+"-group",mask:this.namespace+"-mask",skin:this.namespace+"_"+this.options.skin,open:this.namespace+"_open",disabled:this.namespace+"_disabled",selected:this.namespace+"_selected",focus:this.namespace+"_focus",loading:this.namespace+"_loading",error:this.namespace+"_error"},this.opened=!1,this.eventBinded=!1,this.inFocus=!0,this.currentIndex=this.options.select,this.isScroll=!1,this.last=0,this.disabled=!1,this.initialized=!1,this._trigger("init"),this.init()}return n(t,[{key:"init",value:function(){this.$wrapper=this.$select.wrap('<div class="'+this.classes.wrapper+'"><div class="'+this.classes.old+'" ></div></div>').parent().parent(),this.$trigger=(0,i.default)('<div class="'+this.classes.trigger+'"><div class="'+this.classes.handler+'"></div></div>'),this.$label=(0,i.default)('<div class="'+this.classes.label+'">'+this.options.render.label()+"</div>").prependTo(this.$trigger),this.$dropdown=(0,i.default)('<div class="'+this.classes.dropdown+'"><ul></ul></div>'),this.$ul=this.$dropdown.children("ul"),this.$options=this.$select.find("option"),this.options.skin&&this.$wrapper.addClass(this.classes.skin),this.$select.prop("disabled")&&this.disable(),this.unChooseText=this.$label.text(),this.$dropdown.css("maxHeight",this.options.maxHeight),this.data=this.parse(this.$select.children()),this.update(!0),this.$wrapper.append(this.$trigger).append(this.$dropdown),this.attachInitEvent(),this.options.preload&&this.onLoad(),l.push(this),this.initialized=!0,this._trigger("ready")}},{key:"_trigger",value:function(t){for(var e,s=arguments.length,i=Array(s>1?s-1:0),a=1;a<s;a++)i[a-1]=arguments[a];var n=(e=[this]).concat.apply(e,i);this.$select.trigger(r+"::"+t,n),t=t.replace(/\b\w+\b/g,function(t){return t.substring(0,1).toUpperCase()+t.substring(1)});var o="on"+t;if("function"==typeof this.options[o]){var l;(l=this.options[o]).apply.apply(l,[this].concat(i))}}},{key:"onLoad",value:function(){var t=this,e=this.options.load;e&&this.load(function(s){e.apply(t,[s])})}},{key:"load",value:function(t){var e=this;e.$wrapper.addClass(e.classes.loading),e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&e.addData(t),e.loading||e.$wrapper.removeClass("loading"),e._trigger("load",t)}])}},{key:"render",value:function(t){var e="",s=this,a=function(t){return'<li class="'+s.classes.item+'">'+s.options.render.option.call(s,t)+"</li>"};i.default.each(t,function(t,n){n.group?(e+='<li class="'+s.classes.group+'">',e+='<div class="'+s.namespace+'-group-label">'+s.options.render.group.call(s,n)+"</div>",e+="<ul>",i.default.isArray(n.options)&&i.default.each(n.options,function(t,s){e+=a(s)}),e+="</ul>",e+="</li>"):e+=a(n)}),s.$ul.html(e)}},{key:"freshOptions",value:function(t){var e=this,s="",a=function(t){return'<option value="'+t.value+'">'+t.text+"</option>"};i.default.isArray(t)&&i.default.each(t,function(t,e){e.group?(s+='<optgroup label="'+e.label+'">',i.default.isArray(e.options)&&i.default.each(e.options,function(t,e){s+=a(e)}),s+="</optgroup>"):s+=a(e)}),e.$select.html(s)}},{key:"parse",value:function(t){var e=this,s=[],a=function(){return i.default.extend({},(0,i.default)(this).data(),{value:this.value,text:this.text,slug:e.replaceDiacritics(this.text)})};return t.each(function(){var t=this;"optgroup"===this.tagName.toLowerCase()?!function(){var e=i.default.extend({},(0,i.default)(t).data(),{group:!0,label:t.label,options:[]});(0,i.default)(t).children().each(function(){e.options.push(a.call(this))}),s.push(e)}():s.push(a.call(this))}),this.$options.each(function(t,s){(0,i.default)(s).prop("selected")&&(e.currentIndex=t)}),s}},{key:"update",value:function(t){this.render(this.data),t!==!0&&this.freshOptions(this.data),this.$items=this.$dropdown.find("."+this.classes.item),this.$options=this.$select.find("option"),this.total=this.$items.length,this.last=0,this.initialized&&(this.currentIndex=0),this.$wrapper.removeClass(this.classes.error),this.$dropdown.height()>this.$ul.outerHeight()?this.isScroll=!0:this.isScroll=!1,this.currentIndex>=0?this._set(this.currentIndex):this.$label.text(this.unChooseText)}},{key:"select",value:function(t){"number"==typeof t&&t>=0&&(this.isScroll&&this.scrollToVisibility(t),this._set(t))}},{key:"_set",value:function(t){var e=this.$items[t],s=(0,i.default)(e);this.last=this.currentIndex,this.currentIndex=t,this.$label.text(s.text()),this.$options.length&&(0,i.default)(this.$options[t]).prop("selected",!0),this.$items.removeClass(this.classes.selected),s.addClass(this.classes.selected),this.last!==this.currentIndex&&this._trigger("change",[this.getCurrentData(t).value])}},{key:"getCurrentData",value:function(t){var e=0,s=null;return i.default.each(this.data,function(a,n){n.group?i.default.isArray(n.options)&&i.default.each(n.options,function(i,a){e++,t+1===e&&(s=a)}):(e++,t+1===e&&(s=n))}),s}},{key:"getCurrentIndex",value:function(t){var e=0,s=0;return i.default.each(this.data,function(a,n){n.group?i.default.isArray(n.options)&&i.default.each(n.options,function(i,a){a.value===t&&(s=e),e++}):(n.value===t&&(s=e),e++)}),s}},{key:"get",value:function(){return this.getCurrentData(this.currentIndex).value}},{key:"replaceDiacritics",value:function(t){var e="40-46 50-53 54-57 62-70 71-74 61 47 77".replace(/\d+/g,"\\3$&").split(" "),s=!0,i=!1,a=void 0;try{for(var n,o=e[Symbol.iterator]();!(s=(n=o.next()).done);s=!0){var r=n.value;Object.hasOwnProperty.call(e,r)&&(t=t.toLowerCase().replace(new RegExp("["+e[r]+"]","g"),"aeiouncy".charAt(r)))}}catch(t){i=!0,a=t}finally{try{!s&&o.return&&o.return()}finally{if(i)throw a}}return t}},{key:"position",value:function(){var t=this.$trigger.outerHeight(!0),e=this.$trigger.offset(),s=this.$dropdown.outerHeight(!0),a=void 0;a=s+e.top>(0,i.default)(window).height()+(0,i.default)(window).scrollTop()?-s-parseInt(this.options.offset[0],10):t+parseInt(this.options.offset[0],10),this.$dropdown.css({top:a})}},{key:"attachInitEvent",value:function(){var t=this;"hover"===this.options.trigger?(this.$trigger.on("mouseenter.asSelect",function(){t.open()}),this.$wrapper.on("mouseleave.asSelect",function(){return t.close(),!1})):this.$trigger.on("click.asSelect",function(){t.opened?t.close():t.open()}),this.$select.on("focus.asSelect",function(){t.$wrapper.addClass(t.classes.focus),t.inFocus=!0}).on("blur",function(){t.$wrapper.removeClass(t.classes.focus),t.inFocus=!1}),this.$dropdown.on("click.asSelect","."+this.classes.item,function(){var e=t.$items.index((0,i.default)(this));t.select(e),t.close()})}},{key:"dettachInitEvents",value:function(){this.$trigger.off(".asSelect"),this.$wrap.off(".asSelect"),this.$select.off(".asSelect"),this.$dropdown.off(".asSelect")}},{key:"keyboardEvent",value:function(){var t=this;(0,i.default)(document).on("keydown.asSelect",function(e){var s=e.which||e.keycode;if(/^(9|13|27)$/.test(s))return t.close(),!1;if(s<37||s>40)t.isScroll&&t.search(s);else if(/^(38|40)$/.test(s)){var i=38===s?"up":"down";return t.navigate(i),!1}})}},{key:"search",value:function(t){var e="",s=void 0;clearTimeout(this.timeout),e=new RegExp("^"+(e+=String.fromCharCode(t)),"i"),this.timeout=setTimeout(function(){e=""},16),i.default.each(this.$items,function(t,a){var n=i.default.trim((0,i.default)(a).text());if(e.test(n))return s=t,!1}),s>=0&&this.select(s)}},{key:"scrollToVisibility",value:function(t){var e=this.$items[t],s=void 0,a=(0,i.default)(e).outerHeight(),n=this.$dropdown.scrollTop(),o=n+this.$dropdown.height(),r=(0,i.default)(e).position().top;if(r<n)s=r;else{if(!(r>o-a))return;s=r+a-this.$dropdown.height()}this.$dropdown.scrollTop(s)}},{key:"navigate",value:function(t){var e=this.total,s=this.currentIndex<0?0:this.currentIndex;s="up"===t?s<=0?e-1:s-1:s>=e-1?0:s+1,this.select(s)}},{key:"_generateMask",value:function(){var t=this;"hover"!==this.options.trigger&&(this.$mask=(0,i.default)('<div class="'+this.classes.mask+'"></div>').appendTo(this.$wrapper),this.$mask.on("click.asSelect",function(){return t.close(),!1}))}},{key:"_clearMask",value:function(){"hover"!==this.options.trigger&&(this.$mask.off("click.asSelect"),this.$mask.remove(),this.$mask=null)}},{key:"open",value:function(){this.opened||this.disabled||(this.$select.focus(),this.closeAll(),this.$wrapper.addClass(this.classes.open),this._generateMask(),this.keyboardEvent(),this.position(),this._trigger("open"),this.opened=!0)}},{key:"close",value:function(){this.$wrapper.removeClass(this.classes.open),this._clearMask(),(0,i.default)(document).off("keydown.select"),this._trigger("close"),this.opened=!1}},{key:"closeAll",value:function(){i.default.each(l,function(t,e){e.opened&&e.close()})}},{key:"addData",value:function(t){var e=this;i.default.isArray(t)&&(i.default.each(t,function(s,i){i.group||(t[s].slug=e.replaceDiacritics(i.text))}),this.data=this.data.concat(t),this.update())}},{key:"removeData",value:function(t){return t}},{key:"enable",value:function(){return this.disabled=!1,this.$trigger.removeClass(this.classes.disabled),this._trigger("enable"),this}},{key:"disable",value:function(){return this.disabled=!0,this.$trigger.addClass(this.classes.disabled),this._trigger("disable"),this}},{key:"destroy",value:function(){this.dettachInitEvents(),(0,i.default)(document).off(".asSelect"),this.$dropdown.remove(),this.$trigger.remove(),this.$select.unwrap().unwrap(),this._trigger("destroy")}}],[{key:"setDefaults",value:function(t){i.default.extend(!0,o,i.default.isPlainObject(t)&&t)}}]),t}(),c={version:"0.2.1"},h="asSelect",d=i.default.fn.asSelect,p=function(t){for(var e=this,s=arguments.length,n=Array(s>1?s-1:0),o=1;o<s;o++)n[o-1]=arguments[o];if("string"==typeof t){var r=function(){var s=t;if(/^_/.test(s))return{v:!1};if(!/^(get)/.test(s))return{v:e.each(function(){var t=i.default.data(this,h);t&&"function"==typeof t[s]&&t[s].apply(t,n)})};var a=e.first().data(h);return a&&"function"==typeof a[s]?{v:a[s].apply(a,n)}:void 0}();if("object"===("undefined"==typeof r?"undefined":a(r)))return r.v}return this.each(function(){(0,i.default)(this).data(h)||(0,i.default)(this).data(h,new u(this,t))})};i.default.fn.asSelect=p,i.default.asSelect=i.default.extend({setDefaults:u.setDefaults,noConflict:function(){return i.default.fn.asSelect=d,p}},c)});